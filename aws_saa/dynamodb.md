# DynamoDB

完全マネジメント型のNoSQLデータベースサービス

- ハイスケーラブルで無制限に性能を拡張できる
- 負荷が高くなっても応答速度が低下しない低レイテンシー
- 高可用性（SPOFなしでデータは3箇所のAZに保存）
  - SPOFとは単一障害点のこと
- マネージド型のためメンテナンスフリー
  - CloudWatchで運用
- プロビジョンドスループット
  - テーブルごとにReadとWriteに、必要なスループットキャパシティを割り当てる
    - 例 Read:100/Write:1000
- ストレージの容量制限がない
  - データ容量の増加に応じたディスクやノードの増設は一切不要

## DynamoDBのできること

キーバリュー（ワイドカラム型）でデータを簡易に操作することが主要な役割

### できる

- キーに対するバリュー（値）のCRUD操作
  - Create（生成）、Read（読み取り）、Update（更新）、Delete（削除）
- 簡易なクエリやオーダー
- 例えば、数万人以上が同時アクセスして処理が必要になるアプリケーションのデータ処理など

### できない、むいてない

- JOIN/TRANSACTION/COMMIT/ROLLBACKは不可
- 詳細なクエリやオーダー（データ検索や結合処理などは向いてない）
- 大量のデータの読み書きにはコストがかかる

## DynamoDBの整合性モデル

デフォルトで結果整合性モデルを利用して高速処理をしており、一部処理に強い整合性モデルを利用している

### Write

- 少なくとも2つのAZでの書き込み完了が確認取れた時点で完了

### Read

- デフォルト: 結果整合性モデル
  - 最新の書き込み結果が、即時読み取り処理に反映されない可能性がある
- オプション: 強い整合性モデル
  - GetItem/Query/Scanのコマンドを使った場合には、強い整合性のある読み込みオプションが指定可能

## パーティショニング

大量データを高速処理するためにパーティショニングによる分散処理を実施している。  
NoSQLの特徴でもある。  
テーブルAの読み書きの処理をするために3つAZに分け、並列で実行することによって処理を高速にする

- テーブルA -> テーブルAのパーティションA
- テーブルA -> テーブルAのパーティションB
- テーブルA -> テーブルAのパーティションC

## ユースケース

ビッグデータ処理向けか大量データ処理が必要なアプリケーション向けに利用する

### ビッグデータ

- 大量のデータを収集、蓄積、分析するためのDBとして活用
- Hadoopと連携してビッグデータ処理が可能
- あとはIoTのAWSサービスと連携したりとか

### アプリケーション

- 大規模サービスでのデータ高速処理が必要なアプリケーション向けに活用
- 多数のユーザーが一度にアクセスするようなアプリケーションのデータ処理など
  - 1万人以上が利用するゲームとか

---

例えば、大量に発生しうるWEB行動データやログ管理など

### ユーザー行動データ管理

- ユーザー情報やゲーム、広告などのユーザー行動データ向けDBとしてデータを蓄積していく
- ユーザーIDごとに複数の行動履歴管理

### バックエンドデータ処理

- モバイルアプリのバックエンド
- バッチ処理のロック管理
- フラッシュマーケティング
- ストレージのインデックス

## 適用分析

トランザクションで発生しうるDB処理をチェックして適用可否を検証する

- IoTデータの蓄積、ゲームの行動記録など、大量のデータ処理があっても細かいデータ処理が発生しない場合はDynamoDBを使うべきである
- 反面、銀行の振込といった、 `TRANSACTION` , `COMMIT` , `ROLLBACK` , 大量読み書きが発生するような処理ではRDSが向いている

## テーブル設計

DynamoDBはテーブル単位から利用が開始され、テーブル→項目→属性と設計する。  
RDBとは少し違う

### テーブル

- DynamoDBはテーブルをデータのコレクションとしている
  - DynamoDBのサービスを開始すると「DBを作ろう」ではなく「テーブルを作ろう」から始まる
- 他のDBと同様にテーブル単位にデータを保存する

### 項目（アイテム）

- 各テーブルの中に項目を作ってデータを作成する
- 項目間で一意に識別可能な属性グループとなる
- `Person` という項目を作成すれば、名前やIDなどが属性として付属する

### 属性

- 各項目は1つ以上の属性で構成される
- 属性は最小のデータ単位。それ以上分割する必要がない
- 例えば `Person` 項目には、姓名など名前の `属性` を設定する

---

テーブル、項目、属性の関係性を入れ子状にしてテーブルを設計する

- テーブル
  - 項目（アイテム）
    - 属性、属性、属性、属性...
  - 項目（アイテム）
    - 属性、属性、属性、属性...

- 個人情報
  - Personal
    - ID, LastName, FirstName...

属性はVALUE型やJSON型など、不揃いであっても構わない

## インデックス

DynamoDBは暗黙的に設定するKVSにおけるKEYに値するものと、明示的に設定するキーがインデックスとして利用できる