# Well-Aechitected Framework（AWSアーキテクチャ設計の基礎）

- AWSの提唱する設計原則
- アソシエイト試験はWell-Aechitected Frameworkで提唱されている5つの設計原則に沿った試験範囲になっている

## Reliability: 信頼性

- 障害による中断、停止と障害復旧による影響を軽減するインフラストラクチャを構成する
  - インフラストラクチャサービスの障害復旧の自動化など軽減設計
  - 復旧手順のテストによる検証
  - 需要変化に応じた水平方向へのスケーラビリティに高可用性の確保
    - オートスケーリング
  - キャパシティの推測をやめる
    - 「どのくらいのキャパかな？」と勝手に推測して決めるのをやめる
    - クラウドの特徴を生かしてオンデマンドで対処する
  - モニタリングとの自動化を進める

### 信頼性の主要サービス

信頼性の基本対応領域は『基盤』『変更管理』『障害管理』の3つで成り立っている

#### 基盤

- IAM
  - ちゃんとしたアカウント権限管理をする
- VPC
  - 信頼性の大きな基盤。複数のVPCに分けたりサブネットを分けたりして
- AutoScaling
  - スケーラビリティの自動化
- ELB
  - ロードバランサー
- CloudFormation
  - 環境構築を自動化する

#### 変更管理

モニタリングツール。サービスやインフラの変更点をチェックする

- CloudTrail
- AWS Config

#### 障害管理

- CloudWatch
  - 常にモニタリングする

## Performance Efficiency: パフォーマンス効率

- システム要件のリソース最適化によるインフラの効率化
  - システム要件を満たすためのコンピューティングリソースを効率化する
  - システム要件やAWSサービスの進化に応じてAWSインフラの効率化を推進する
    - 先端技術の一般化
    - グローバル化を即座に達成
    - サーバレスアーキテクチャの利用
      - 最近ではEC2よりLambdaを使うことが求められる
    - より頻繁な実験

### パフォーマンス効率の主要サービス

#### コンピューティング

コスト効率、パフォーマンスが良いものを作っていく

- AutoScaling
- Lambda

#### ストレージ

ライフサイクル設定とか効率的にデータを保存する

- EBS
- S3
- Glacier
- EFS

#### データベース

用途に応じて活用シーンが違うので最適をチョイスをする

- RDS
- DynamoDB
- Elastic search
- Aurora
- Redshift

#### 容量と時間のトレードオフ

キャッシュサービスを使ったり、データ容量に制限されないように素早くアクセスできるようにする

- CloudFront
- ElasticCache

## Security: セキュリティ

- 

## コスト最適化

## オペレーショナルエクセレンス（運用上の優秀性）

- ベストプラクティスを利用することで最適解や改善点を把握する（あくまで参考であり絶対に準拠すればいいというものではない）
  - 要件定義
    - AWSを利用したシステム要件を検討する材料としてホワイトペーパーを確認して最適な要件検討に利用する
  - 設計
    - ホワイトペーパーを確認しながら、最適な設計方式を検討する
  - 構築
    - リリース前にAWSのインフラ構成にリスクや改善点がないか、ホワイトペーパーやツールを使って確認する
  - 運用
    - 運用中に定期的にホワイトペーパーに沿ったレビューを実施し、なにかズレやリスク、改善点がないか確認する

## Well-Aechitected Frameworkを構成する3つの要素

### 1. Well-Aechitected Frameworkホワイトペーパー

- 5つの設計原則について説明したホワイトペーパー

### 2. AWSのSAまたは認定パートナーによる支援制度

- SA（サポーター社員）や支援会社によるサポート制度

### 3. セルフチェック向けのWell-Aechitected Tool

- ツールを使って設計原則に沿っているかどうかをチェックする

## AZの選択

- 1つのリージョンにつき2つのAZを利用してアーキテクチャを設計することが基本（3つ以上はコスト効率が低下する）
  - ひとつのAZにEC2を作ったら、レプリケーションやロードバランサーを使った負荷分散するEC2を別のAZに置く
- マルチAZにサーバーやDBの冗長構成を確立させることで高い可用性を実現する
  - また、リージョンにおいたS3にレプリケーションでバックアップを取るなどする

## VPC

- 2つ以上のVPCでアーキテクチャを設計するのが基本となる
  - 1つのVPCだと……
    - 可用性が低下するため、アイデンティティ管理や、ハイパフォーマンス・コンピューティング（高性能計算）などに用途は限られる
    - 一人などの小規模な利用の場合は2つ以上VPCを利用するのが面倒なケースもある
- システム単位や組織単位で分ける
  - 『開発環境』と『本番環境』など
- ネットワークの分割方法はマルチVPC方式とマルチアカウント方式を選択する
  - 組織とかシステム単位によって分割方式を変えていく
  
### マルチVPC方式

- 複数のAZに跨いで、複数のシステムにVPCで分割していく
  - VPC[Aシステム] VPC[Bシステム] VPC[共通サービス] VPC[Cサービス]

### マルチアカウント方式

- それぞれアカウント別にVPCを設定していく
  - VPC[A部署アカウント] VPC[B部署アカウント] VPC[共通サービスアカウント] VPC[C部署アカウント]

## サブネットの分割

- サブネットはCIDR範囲で分割したネットワークセグメント
- パブリックサブネットとプライベートサブネットで分かれている
- WEBアクセスが必要か否かでパブリックとプライベートに分割
- サブネットのサイズは `/24` 以上の大きいサブネットを推奨
- それぞれのAZの中にパブリックとプライベートを設置するのが一般的
- プライベートサブネットに多くのIPアドレスを割り当てる

### パブリックサブネット

- インターネットと接続が必要なリソースを揃える
- インターネットとのアクセス制御に利用する
- ウェブアプリケーションのインターネットアクセス制御

### プライベートサブネット

- インターネットから隔離することでセキュリティを高める
- データベース処理
- バッチ処理インスタンス
- バックエンドのインスタンス

## VPC間接続の設計

- VPC peeringにより2つのVPC間でのトラフィックルーティングが可能
- 接続が必要なVPCはそれぞれペアリングが必要となる
