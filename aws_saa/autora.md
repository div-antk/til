# Aurora

クラウド時代の新しい分散型のRDBとして誕生

- Amazonがクラウド時代に適したRDBをイチから考えて構築した
- NoSQL型の分散高速処理とRDBとしてのデータ操作性を両立させた特徴
- オンプレではなくクラウド用
- MySQLと比較して2.5〜5倍の性能を商用DBの10分の1の価格で提供する、高性能、低コストのDB

## 特徴

高い並列処理性能によって大量の読み書きをするのに適したDB

- 高い並列処理によるストレージアクセスによって、クエリを高速処理することが可能
- Auroraは大量の書き込みや読み込みを同時に扱うことができる
- DBの集約やスループット向上が見込まれる
- ただし、全てが5倍高速というわけではなく、適用すべき領域を見つけて利用する
  - すべてのクエリが5倍というわけではない
- 基本はMySQL、PostgreSQLと互換性があり、同じ操作方法と技術のコミュニティを利用することが可能
  - MySQL5.6、PostgreSQLと互換性のあるものを選択可能

---

- 分散型で耐障害性と自己回復性を備えたスケーラブルな新しいタイプのマネージド型RDB

### 耐障害、自己回復性

- 3つのAZに2つのコピーを設置可能で、合計6つのコピーを保持
- 過去のデータがそのままS3に継続的に増分バックアップ
- リストアも差分適用がなく高速
- どのタイミングでも安定したリストア時間を実現
- 99.99%の高可用性、高耐久性をフルマネージドで実現

### スケーラビリティ

- 10GBから最大64TBを提供するSSDを使ったデータプレーンを利用してシームレスに拡張可能
- Auto-Scalingなどのクラウド独自のスケーラブルが可能
- 最大15のリードレプリカを利用した高速読み込みが可能

## DBクラスタの仮想ボリューム

Auroraは1つのDBインスタンスと1つのDBクラスタボリュームで構成される。  
3つのAZにコピーされたクラスタを単一と認識

- AZ-1、AZ-2、AZ-3にコピーが最大2つづつ、仮想ボリュームとして作られる

## DBクラスタ構成

AuroraはマスタとリードレプリカをまとめたDBクラスタを構成

- AZ-1のプライベートサブネットにAurora Writerという書き込み専用マスタ
- AZ-2のプライベートサブネットにAutora Readerというリードレプリカが最大15個作ることができる
- これらをまとめたものがDBクラスタ構成で、これによって読み込みが高速になる
- これらのマスタとレプリカはエンドポイントから接続する
  - EC2で書き込み処理が行われると、エンドポイントを中継してマスタのAurora Writerへ行く
  - 読み込み処理だとリードレプリカのAutora Readerへ行く
  - マスタが止まるとリードレプリカへ行く

## マイグレーション

MySQLとPostgreSQLのスナップショットからAuroraへとマイグレーションが可能

- MySQL -> スナップショット -> Autora with MySQL

## Auroraマルチマスター

マスターDBを複数構築してWrite性能もスケーラブルに構築可能

- これまではマスタのWriterから各AZのリードレプリカであるReader（最大15個）に枝分かれしていた
- マスタから別AZのマスタに繋げることができる（2017年〜）
  - どのノードが落ちてもダウンタイムがゼロに
  - どのAZが落ちてもダウンタイムがゼロに
  - Write性能のスケーリング

## Auroraサーバレス

予測困難なアプリケーションワークロードに対応したAuroraのオンデマンド自動スケーリング構成

- アプリケーションのニーズに基づいて実行される
  - 自動的に起動、シャットダウン
  - 自動でスケールアップ、スケールダウン
- アプリケーションの負荷が上下しやすいものに使うと良い

## AuroraグローバルDB

他リージョンに対する高性能なリードレプリカ作成機能

- ログ転送ではなく、ストレージレベルの機能を利用して高性能なレプリケーションを実施
- 何が違うのかというと、低レイテンシーレプリケーションを実現できるところ。概ね1秒以下で、最大でも5秒でレプリケーションを実行する

## ユースケース

大規模なクエリ処理が発生するRDB環境などをAutoraへ移行することを検討すべし。  
中小規模であればMySQLやPostgreSQLでも問題ない

### 大規模なクエリデータ処理

- 書き込み量が多く、トランザクション量が多い
- クエリ並行度が高い。データサイズが大きいケースで効果を発揮する
- コネクション数やテーブル数が多いDB処理

### 運用の容易さを活用する

- スケーラビリティの高さやデータ容量が無制限に拡張できる
- レプリケーションなどの性能の高さ

## Auroraを作るハンズオンのメモ

- 『グローバル』で設定すると可用性を高めることができる（今回はリージョン別）
- 1つのライターと複数のリーダー
- 今回は『開発/テスト』用
- 可用性の基本として『別のAZでAuroraレプリカ/リーダーノードを作成する』を選択
- 作成するとこれまでと違ってクラスター構成でDBが表示されるようになる
- アクションから『クロスリージョンレプリカ』で最大5つまでリージョンを跨いだレプリカを作ることができる
- 『クローンの作成』で選択しているDBの設定を素早く再現することができる。スナップショットで作るよりも手軽で簡単にできる
- RDSとの大きな違いはクラスタ表示になっており、リーダーの追加、クロスリージョンレプリカの作成、クローンの作成ができるようになっていること
- 『エンドポイント』に表示されているものをコピーしてターミナルからSSH接続する
