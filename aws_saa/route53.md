# Route53

権威DNSサーバの機能をマネジメント型で簡単に利用できるサービス

- 主要機能はドメイン登録、DNSルーティング、ヘルスチェックの3つ
- ポリシーによるルーティング設定
  - トラフィックルーティング、フェイルオーバー、トラフィックフローに基づく様々な条件のルーティング設定が可能
- AWS側で100%可用性を保証するSLA（サービス品質保証）
  - 「絶対に落ちないよ」という保証
- マネージドサービスとして提供しており、ユーザー側で冗長性などを考慮する必要がない

## DNS (Domain Name Service)

DNDはインターネットにおける人向けのURLを、システム向けの住所となるIPアドレスに変換するための仕組み

- 名前解決機能があるものを**権威DNSサーバ**
- 一時的にDNS情報を企業のサーバに保持しておくことで名前解決がすぐできるようにすることに使われるものを**キャッシュDNSサーバ**

Route53はAWSが提供する権威DNSサーバで、ポート53で動作することからRoute53と呼ばれる

- **DNSレコード**というIPアドレスとURLを紐づけた表を確認してルーティングする

## 利用方法

Route53の利用を開始してドメインを登録するとホストゾーンを自動生成し、そこにルーティングを設定する

1. Route53にドメインを設定
2. ドメイン名と同じホストゾーンを自動生成
3. ホストゾーンにルーティング方法となるDNSレコードを作成
4. トラフィックルーティングを設定

## ホストゾーン

ドメイン（example.com）とそのサブドメイン（sub.example.com）のトラフィックのルーティングする方法についての情報を保持するコンテナ

### パブリックホストゾーン

- インターネット上に公開されたDNSドメインレコードを管理するコンテナ
- インターネットのDNSドメインに対するトラフィックのルーティング方法を定義

### プライベートホストゾーン

- VPCに閉じたプライベートネットワーク内のDNSドメインのレコードを管理するコンテナ
- VPC内のDNSドメインに対して、どのようにトラフィックをルーティングするかを定義
- 1つのプライベートホストゾーンで複数VPCに対応
- VPCが相互アクセス可能であれば複数リージョンのVPCでも、同じホストゾーンを利用可能

## DNSレコード

ルーティング方法を設定するためにDNSレコードを作成し、各種レコードを設定するのがDNSを使う基本になる

### SOA

- ドメインのDNSサーバ、ドメイン管理者のメールアドレス、シリアル番号などを保持して、ゾーン転送時に情報が更新されているかの判断に利用する
- トップレイヤー

### A

- ホスト名とIPアドレスの関連づけを定義するレコード
- 非常に重要なレコード

### MX

- メール用
- メールの配送先（メールサーバ）のホスト名を定義するレコード

### CNAME

- 正規ホスト名に対する別名を定義するレコード。特定のホスト名を別のドメイン名に転送するときなどに利用する
- URLを変更したりするときとか

### ALIAS (Route53固有の仮想リソースレコード)

- DNSクエリにAWSサービスのエンドポイントのIPアドレスを返答
- 以下のサービスを設定可能
  - 静的ウェブサイトとして設定されたS3バケット
  - CloudFront
  - ELB
  - ホストゾーン内のリソースレコードセット
    - 静的WEBサイトとして設置されたS3バケット、CloudFront、ELBなど

#### ALIASレコードのメリット

- DNSクエリに対するレスポンスが高速
- CNAMEにマッピングできないZone Apex（ドメイン名そのもの）を設定可能
- ALIASレコードに対するクエリが無料であり、Route53と連携したDNS Lookupを高速化する
- CloudFrontでのクエリ回数を削減

## トラフィックルーティングのタイプ

様々なルーティング方式を選択して設計することが可能

### シンプルルーティング（Simple）

- レコードセットで事前に設定された値のみに基づいてDNSクエリに応答する
- 静的なマッピングによりルーティングを決定

### 加重ルーティング（Weighted）

- 複数エンドポイントごとの重み設定によりDNSクエリに応答する
- 7:3などで分けた場合などの、重み付けの高いエンドポイントに多くルーティングする

### レイテンシールーティング（Latency）

- リージョンの遅延によりDNSに応答する
- リージョン間の遅延が少ない方へルーティングされる

### フェイルオーバールーティング（Failover）

- ヘルスチェックの結果に基づいて、利用可能なリソースをDNSクエリに応答する
- 利用可能なリソースにのみルーティングされる

### 位置情報ルーティング（Geolocation）

- クライアントの位置情報に基づきDNSクエリに応答する
- 特定の地域、国からのDNSクエリに対して特定のアドレスを応答
  - 例えば日本のクエリに対して日本のサーバを使ったり、国ごとによってトップページの言語を変えたりといったことが可能

### マルチバリュールーティング

- 別々のレコードにIPアドレスを設定する
- IPアドレス単位でヘルスチェックを実施してルーティングする
  - それまでのヘルスチェックのルーティングは、ひとつのレコードに複数のIPアドレスを紐づけることにより、IPアドレス単位でヘルスチェックができない

## トラフィックフロー

従来はALIASレコードを駆使して複雑なルーティングポリシーを作成していたが、トラフィックフローによる視覚的なフローマッピングでの複雑なポリシー設定が可能になった

## ホストゾーンの設定ハンズオンのメモ

- Route53から『ドメインの登録』
  - 年額いくらでドメインが売っている
- 『DNS管理』から既存のドメインを使う
  - 『ホストゾーンを始める』からドメインを入力してパブリックを選択
  - 作成したらネームサーバーの『値』をコピーして『お名前.com』に貼り付けていく（4点）

### シンプルルーティングのハンズオンのメモ

1. NslookupコマンドでドメインとIPが設定されたか確認する
2. シンプルルーティングを設定して、ドメイン名でWEBページが表示されたかを確認する

- 