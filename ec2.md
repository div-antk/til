# EC2

- 秒単位で利用可能な仮想サーバー
- 起動、ノード追加、削除、マシンスペック変更が数分で可能
- OSより上のレイヤーを自由に利用可能
- 任意のAZにインスタンスを立ち上げてサーバーとして利用する

## セッティング

1. 利用するAMIイメージを選択
2. インスタンスタイプを選択
3. ストレージを選択
4. セキュリティグループを選択
5. SSHキーペアを設定

## AMI

- インスタンス起動用のOSイメージ
- サードパーティ制のものも売ってたりする

## インスタンスタイプ

- CPU、メモリ、ストレージ、ネットワークキャパシティなどのサーバーリソースの選択
- 性能が高くなると値段が高くなる
- t2.nano の場合

t2（ファミリーと世代）  
nano（インスタンスの容量）

### インスタンスファミリー

用途に応じて選択する

- M5: 汎用
- T2: 汎用
- C5: コンピューティング最適化
- D2: ストレージ最適化
- R4: メモリ最適化
- X1: メモリ最適化
- F1: FPGA
- G3: GPU（機械学習とかゲームとかで使うメモリ）

## リザーブドインスタンス

利用期間を長期指定すると最大75％割になる

- スタンダードタイプとコンバーティブルタイプがあり、変更や柔軟性の違いがある
- 変更可能なエリアが多いのがコンバーティブル（AZ、インスタンスサイズ、ネットワークタイプを変更可能）

## スポットインスタンス

- 予備のインスタンスを一時的に借りられる
- 入札式で値段がマッチングしたら買える
- 予備用なので途中で削除されることもある
- 一時的な拡張などの用途で利用する

## 物理対応可能なインスタンス

物理サーバーにインスタンスを起動して制御が可能なタイプのインスタンス

### ハードウェア専有インスタンス

### Dedicated Host

### Bare Metal

物理的なサーバーを操作するのと近い感覚で使える

## ストレージ

- 2つのタイプがある
- EC2の『ボリュームタイプ』で選択する

### インスタンスストア

- EC2のサーバーに最初からついてるもの
- 一時的な保持のため、EC2を停止、終了するとクリアされる
- 無料

### EBS (Elastic Block Store)

- EC2と独立して管理される（別サーバー）。
- EC2をTerminateしても保持される。SnapshotをS3に保持可能
- 別途料金が必要

## セキュリティグループ

- インスタンスへのどういった形式のアクセスを求めるかの設定
- 「SSHでのアクセスは通してHTTPでのアクセスはできない」といった設定
- 特定のIPアドレスのみアクセスできるといった設定もできる

## キーペア

- 秘密鍵を使ってEC2にアクセスする
- EC2側の公開鍵と自分の秘密鍵がマッチするとインスタンスにアクセスできる
- VPCにおいて最大5,000個

## EC2のバックアップ

- 定期的にバックアップを取る
- 定期的にリカバリプロセスを確認する
- 複数のAZに重要なアプリケーションをデプロイする
- フェイルオーバー対応（片方がぶっ壊れたら自動でもう一方に切り替える）
- イベントをCloudWatchなどでモニタリングする
- インスタンス起動時に動的IPアドレス処理の設定を行う

## EC2でWEBサーバーを立ち上げる

1. インスタンスを新規で立ち上げる
2. SSH接続する
3. Apacheのインストール（WEBサーバー）
4. Apache内にindex.htmlを作る

- EC2作成時の『ステップ3』の『ネットワーク』でデフォルトのVPCが充てられているが、本来であればVPCを作成してからEC2インスタンスを充てる

## Elastic IPの設定

- 動的に変わらない静的なIPを設定していく
- インスタンスを停止->再開を行うとパブリックIPが変わってしまうため
- 停止した状態で設定を行う
- 作ったIPを関連付けしないで解放していると料金が発生する

1. Elastic IPの割当
2. EC2インスタンスへのElastic IPの設定
3. Elastic IPの解放

## Bashシェルスクリプトによる設定

### シェルスクリプト

ユーザーとカーネル（OSの基幹機能）とのやり取りで利用される言語

### Bash

Linuxにおけるデファクトスタンダード（事実上の標準）になっているシェルスクリプト

- SSH接続したあとにBashでLinuxを操作する
- 毎回同じ設定（初期設定）をするのが面倒（Apacheのインストールなど）なことをBashで一括設定する
- AWSマネジメントコンソールにて設定できる
- インスタンスの起動のときに仕込んでおく

1. インスタンスを起動
2. Bashシェルスクリプトの設定
3. Linuxの設定結果を確認する

- EC2作成時の『ステップ3』の『高度な設定（ユーザーデータ）』でテキスト形式でbashスクリプトを書いていく

```bash
#!/bin/bash
# サーバーの設定変更
sed -i 's/^HOSTNAME=[a-zA-Z0-9\.\-]*$/HOSTNAME=udemy-bash/g' /etc/sysconfig/network
hostname 'udemy-bash'
cp /usr/share/zoneinfo/Japan /etc/localtime
sed -i 's|^ZONE=[a-zA-Z0-9\.\-\"]*$|ZONE="Asia/Tokyo"|g' /etc/sysconfig/clock
echo "LANG=ja_JP.UTF-8" > /etc/sysconfig/i18n
# アパッチのインストール
sudo yum update -y
sudo yum install httpd -y 
sudo chkconfig httpd on
====
```

`yum list installed | grep httpd`  
でyumがちゃんとインストールされているかを確認する
